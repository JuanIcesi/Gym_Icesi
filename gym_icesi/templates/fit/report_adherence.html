{% extends 'base.html' %}
{% block title %}Informe de Adherencia - Gym Icesi{% endblock %}

{% block content %}
<div style="margin-bottom:2rem;">
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;">
    <div>
      <h1 style="margin:0;">ğŸ“Š Informe de Adherencia y Consistencia</h1>
      <p style="color:#6b7280;margin:0.5rem 0 0 0;">Seguimiento de tu actividad fÃ­sica del {{ periodo.0|date:"d M Y" }} al {{ periodo.1|date:"d M Y" }}</p>
    </div>
  </div>

  <!-- Selector de mes/aÃ±o -->
  <div class="card" style="margin-bottom:1.5rem;">
    <form method="get" style="display:flex;gap:1rem;align-items:end;flex-wrap:wrap;">
      <div style="flex:1;min-width:150px;">
        <label for="month" style="display:block;margin-bottom:0.5rem;font-weight:500;">Mes:</label>
        <select name="month" id="month" style="width:100%;padding:0.75rem;border:1px solid #d1d5db;border-radius:6px;">
          {% for i in "123456789101112"|make_list %}
            <option value="{{ i }}" {% if month == i|add:0 %}selected{% endif %}>
              {% if i == "1" %}Enero{% elif i == "2" %}Febrero{% elif i == "3" %}Marzo{% elif i == "4" %}Abril{% elif i == "5" %}Mayo{% elif i == "6" %}Junio{% elif i == "7" %}Julio{% elif i == "8" %}Agosto{% elif i == "9" %}Septiembre{% elif i == "10" %}Octubre{% elif i == "11" %}Noviembre{% elif i == "12" %}Diciembre{% endif %}
            </option>
          {% endfor %}
        </select>
      </div>
      <div style="flex:1;min-width:120px;">
        <label for="year" style="display:block;margin-bottom:0.5rem;font-weight:500;">AÃ±o:</label>
        <input type="number" name="year" id="year" value="{{ year }}" min="2020" max="{% now 'Y' %}" style="width:100%;padding:0.75rem;border:1px solid #d1d5db;border-radius:6px;">
      </div>
      <div>
        <button type="submit" class="btn">Ver Informe</button>
      </div>
    </form>
  </div>

  <!-- Stats principales -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:1rem;margin-bottom:2rem;">
    <div class="card" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:1.5rem;">
      <div style="font-size:0.9rem;opacity:0.9;margin-bottom:0.5rem;">DÃ­as Activos</div>
      <div style="font-size:2.5rem;font-weight:bold;">{{ dias_activos }}</div>
      <div style="font-size:0.85rem;opacity:0.8;margin-top:0.25rem;">de {{ dias_del_mes }} dÃ­as</div>
    </div>

    <div class="card" style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%);color:white;padding:1.5rem;">
      <div style="font-size:0.9rem;opacity:0.9;margin-bottom:0.5rem;">Porcentaje Adherencia</div>
      <div style="font-size:2.5rem;font-weight:bold;">{{ porcentaje_adherencia }}%</div>
      <div style="font-size:0.85rem;opacity:0.8;margin-top:0.25rem;">del mes</div>
    </div>

    <div class="card" style="background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);color:white;padding:1.5rem;">
      <div style="font-size:0.9rem;opacity:0.9;margin-bottom:0.5rem;">Racha Actual</div>
      <div style="font-size:2.5rem;font-weight:bold;">{{ racha_actual }}</div>
      <div style="font-size:0.85rem;opacity:0.8;margin-top:0.25rem;">dÃ­as consecutivos</div>
    </div>

    <div class="card" style="background:linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);color:white;padding:1.5rem;">
      <div style="font-size:0.9rem;opacity:0.9;margin-bottom:0.5rem;">Cumplimiento</div>
      <div style="font-size:2.5rem;font-weight:bold;">{{ porcentaje_cumplimiento }}%</div>
      <div style="font-size:0.85rem;opacity:0.8;margin-top:0.25rem;">vs planificado</div>
    </div>
  </div>

  <!-- ComparaciÃ³n: DÃ­as planificados vs reales -->
  <div class="card" style="margin-bottom:1.5rem;">
    <h3 style="margin:0 0 1rem 0;">ğŸ“… DÃ­as Planificados vs DÃ­as Realmente Entrenados</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
      <div style="padding:1rem;background:#f0fdf4;border-radius:8px;border:2px solid #86efac;">
        <div style="font-size:0.9rem;color:#166534;margin-bottom:0.5rem;">DÃ­as Planificados (Estimado)</div>
        <div style="font-size:2rem;font-weight:bold;color:#15803d;">{{ dias_planificados_estimados }}</div>
        <p style="font-size:0.85rem;color:#166534;margin:0.5rem 0 0 0;">
          Basado en rutinas activas (3-4 veces por semana)
        </p>
      </div>
      <div style="padding:1rem;background:#eff6ff;border-radius:8px;border:2px solid #93c5fd;">
        <div style="font-size:0.9rem;color:#1e40af;margin-bottom:0.5rem;">DÃ­as Realmente Entrenados</div>
        <div style="font-size:2rem;font-weight:bold;color:#2563eb;">{{ dias_activos }}</div>
        <p style="font-size:0.85rem;color:#1e40af;margin:0.5rem 0 0 0;">
          Sesiones registradas este mes
        </p>
      </div>
    </div>
    <div style="margin-top:1rem;padding:1rem;background:#f9fafb;border-radius:8px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
        <span style="font-weight:500;">Porcentaje de Cumplimiento:</span>
        <span style="font-size:1.5rem;font-weight:bold;color:{% if porcentaje_cumplimiento >= 80 %}#10b981{% elif porcentaje_cumplimiento >= 50 %}#f59e0b{% else %}#ef4444{% endif %};">
          {{ porcentaje_cumplimiento }}%
        </span>
      </div>
      <div style="background:#e5e7eb;border-radius:4px;height:12px;overflow:hidden;">
        <div style="height:100%;background:{% if porcentaje_cumplimiento >= 80 %}#10b981{% elif porcentaje_cumplimiento >= 50 %}#f59e0b{% else %}#ef4444{% endif %};width:{% if porcentaje_cumplimiento > 100 %}100{% else %}{{ porcentaje_cumplimiento }}{% endif %}%;"></div>
      </div>
    </div>
  </div>

  <!-- DistribuciÃ³n por tipo -->
  {% if por_tipo %}
  <div class="card" style="margin-bottom:1.5rem;">
    <h3 style="margin:0 0 1rem 0;">ğŸ“ˆ DistribuciÃ³n de Sesiones por Tipo de Ejercicio</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:1rem;">
      {% for row in por_tipo %}
        <div style="padding:1rem;background:#f9fafb;border-radius:8px;border-left:4px solid {% if row.routine__items__exercise__tipo == 'cardio' %}#ef4444{% elif row.routine__items__exercise__tipo == 'fuerza' %}#3b82f6{% else %}#10b981{% endif %};">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
            <span class="badge badge-{{ row.routine__items__exercise__tipo }}" style="font-size:0.9rem;">
              {% if row.routine__items__exercise__tipo == 'cardio' %}ğŸƒ Cardio
              {% elif row.routine__items__exercise__tipo == 'fuerza' %}ğŸ’ª Fuerza
              {% elif row.routine__items__exercise__tipo == 'movilidad' %}ğŸ§˜ Movilidad
              {% else %}{{ row.routine__items__exercise__tipo|title }}
              {% endif %}
            </span>
            <strong style="font-size:1.5rem;color:#111827;">{{ row.sesiones }}</strong>
          </div>
          <div style="background:#e5e7eb;border-radius:4px;height:8px;overflow:hidden;">
            <div style="height:100%;background:{% if row.routine__items__exercise__tipo == 'cardio' %}#ef4444{% elif row.routine__items__exercise__tipo == 'fuerza' %}#3b82f6{% else %}#10b981{% endif %};width:{% widthratio row.sesiones total_sesiones 100 %}%;"></div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Sugerencias -->
  <div class="card" style="background:#f0fdf4;border:2px solid #86efac;margin-bottom:1.5rem;">
    <h3 style="color:#166534;margin:0 0 1rem 0;">ğŸ’¡ Sugerencias</h3>
    {% if mejor_semana %}
      <p style="color:#15803d;margin:0 0 0.5rem 0;">
        <strong>Tu mejor semana fue la Semana {{ mejor_semana.0 }}</strong> con {{ mejor_semana.1 }} sesiones.
        Intenta replicar ese ritmo para mantener la consistencia.
      </p>
    {% endif %}
    {% if dias_activos >= 15 %}
      <p style="color:#15803d;margin:0 0 0.5rem 0;">
        Â¡Excelente adherencia! EstÃ¡s manteniendo una rutina muy consistente. ContinÃºa asÃ­ para maximizar tus resultados.
      </p>
    {% elif dias_activos >= 8 %}
      <p style="color:#15803d;margin:0 0 0.5rem 0;">
        Buen trabajo. Intenta incrementar gradualmente tu frecuencia de entrenamiento para alcanzar tus objetivos mÃ¡s rÃ¡pido.
      </p>
    {% elif dias_activos > 0 %}
      <p style="color:#15803d;margin:0 0 0.5rem 0;">
        EstÃ¡s empezando bien. Trata de establecer una rutina mÃ¡s consistente, apuntando a al menos 3-4 dÃ­as de actividad por semana.
      </p>
    {% else %}
      <p style="color:#15803d;margin:0;">
        No has registrado actividad este mes. Â¡Es momento de comenzar! Establece metas pequeÃ±as y alcanzables para mantener la motivaciÃ³n.
      </p>
    {% endif %}
  </div>

  <!-- Rutinas mÃ¡s usadas -->
  {% if rutinas_mas_usadas %}
  <div class="card" style="margin-bottom:1.5rem;">
    <h3 style="margin:0 0 1rem 0;">â­ Rutinas MÃ¡s Utilizadas</h3>
    <div style="display:flex;flex-direction:column;gap:0.75rem;">
      {% for rutina in rutinas_mas_usadas %}
        <div style="padding:1rem;background:#f9fafb;border-radius:8px;display:flex;justify-content:space-between;align-items:center;">
          <strong style="color:#111827;">{{ rutina.routine__nombre }}</strong>
          <span class="badge badge-primary">{{ rutina.veces }} vez{{ rutina.veces|pluralize:"es" }}</span>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- NavegaciÃ³n -->
  <div style="display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;margin-top:2rem;">
    <a href="{% url 'report_progress' %}" class="btn">ğŸ“Š Ver Informe de Progreso</a>
    <a href="{% url 'report_progress_trend' %}" class="btn">ğŸ“ˆ Ver Tendencias</a>
    <a href="{% url 'home' %}" class="btn btn-secondary">â† Volver al Dashboard</a>
  </div>
</div>
{% endblock %}
