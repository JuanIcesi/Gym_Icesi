{% extends 'base.html' %}
{% block title %}Informe de Adherencia - Gym Icesi{% endblock %}

{% block content %}
<div style="margin-bottom:2rem;">
  <h1>ğŸ“Š Informe de Adherencia</h1>
  <p>Seguimiento de tu actividad fÃ­sica del {{ periodo.0|date:"d M Y" }} al {{ periodo.1|date:"d M Y" }}</p>
</div>

<!-- Stats principales -->
<div class="stats-grid" style="grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));">
  <div class="stat-card">
    <span class="stat-icon">ğŸ“…</span>
    <div class="stat-value">{{ dias_activos }}</div>
    <div class="stat-label">DÃ­as Activos</div>
  </div>

  <div class="stat-card">
    <span class="stat-icon">ğŸ’ª</span>
    <div class="stat-value">{{ por_tipo|length }}</div>
    <div class="stat-label">Tipos de Ejercicio</div>
  </div>

  <div class="stat-card">
    <span class="stat-icon">ğŸ”¥</span>
    <div class="stat-value">{{ porcentaje_adherencia }}%</div>
    <div class="stat-label">Adherencia Mensual</div>
  </div>

  <div class="stat-card">
    <span class="stat-icon">âš¡</span>
    <div class="stat-value">{{ esfuerzo_promedio }}/10</div>
    <div class="stat-label">Esfuerzo Promedio</div>
  </div>

  <div class="stat-card">
    <span class="stat-icon">ğŸ“Š</span>
    <div class="stat-value">{{ total_sesiones }}</div>
    <div class="stat-label">Total Sesiones</div>
  </div>
</div>

<!-- DistribuciÃ³n por tipo -->
<div class="card">
  <h3>ğŸ“ˆ DistribuciÃ³n de Sesiones por Tipo de Ejercicio</h3>
  {% if por_tipo %}
    <table>
      <thead>
        <tr>
          <th>Tipo de Ejercicio</th>
          <th style="text-align:center;">Sesiones</th>
          <th style="text-align:right;">Progreso Visual</th>
        </tr>
      </thead>
      <tbody>
        {% for row in por_tipo %}
          <tr>
            <td>
              <span class="badge badge-{{ row.routine__items__exercise__tipo }}">
                {% if row.routine__items__exercise__tipo == 'cardio' %}ğŸƒ Cardio
                {% elif row.routine__items__exercise__tipo == 'fuerza' %}ğŸ’ª Fuerza
                {% elif row.routine__items__exercise__tipo == 'movilidad' %}ğŸ§˜ Movilidad
                {% else %}{{ row.routine__items__exercise__tipo|title }}
                {% endif %}
              </span>
            </td>
            <td style="text-align:center;font-weight:700;font-size:1.25rem;color:var(--brand);">
              {{ row.sesiones }}
            </td>
            <td style="text-align:right;">
              <div class="progress-bar" style="width:200px;max-width:100%;margin-left:auto;">
                <div class="progress-fill" style="width:{% widthratio row.sesiones 20 100 %}%;"></div>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ“Š</div>
      <p>No hay datos de ejercicios para este perÃ­odo.</p>
      <a href="{% url 'progress_create' %}" class="btn btn-success">Registrar Primera SesiÃ³n</a>
    </div>
  {% endif %}
</div>

<!-- Recomendaciones -->
<div class="card" style="background:#f0fdf4;border-color:#bbf7d0;margin-top:1.5rem;">
  <h3 style="color:#166534;">ğŸ’¡ Recomendaciones</h3>
  {% if dias_activos >= 15 %}
    <p style="color:#15803d;margin-bottom:0;">
      Â¡Excelente adherencia! EstÃ¡s manteniendo una rutina consistente.
      ContinÃºa asÃ­ para maximizar tus resultados.
    </p>
  {% elif dias_activos >= 8 %}
    <p style="color:#15803d;margin-bottom:0;">
      Buen trabajo. Intenta incrementar gradualmente tu frecuencia de entrenamiento
      para alcanzar tus objetivos mÃ¡s rÃ¡pido.
    </p>
  {% elif dias_activos > 0 %}
    <p style="color:#15803d;margin-bottom:0;">
      EstÃ¡s empezando bien. Trata de establecer una rutina mÃ¡s consistente,
      apuntando a al menos 3-4 dÃ­as de actividad por semana.
    </p>
  {% else %}
    <p style="color:#15803d;margin-bottom:0;">
      No has registrado actividad este mes. Â¡Es momento de comenzar!
      Establece metas pequeÃ±as y alcanzables para mantener la motivaciÃ³n.
    </p>
  {% endif %}
</div>

<!-- Rutinas mÃ¡s usadas -->
{% if rutinas_mas_usadas %}
<div class="card" style="margin-top:1.5rem;">
  <h3>â­ Rutinas MÃ¡s Utilizadas</h3>
  <ul>
    {% for rutina in rutinas_mas_usadas %}
      <li style="padding:0.5rem 0;border-bottom:1px solid #e5e7eb;">
        <strong>{{ rutina.routine__nombre }}</strong> - {{ rutina.veces }} vez{{ rutina.veces|pluralize:"es" }}
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<!-- NavegaciÃ³n a otros reportes -->
<div style="margin-top:2rem;text-align:center;">
  <a href="{% url 'report_load_balance' %}" class="btn">Ver Informe de Carga â†’</a>
  <a href="{% url 'report_progress_trend' %}" class="btn" style="margin-left:0.5rem;">Ver Tendencias â†’</a>
  <a href="{% url 'report_achievements' %}" class="btn" style="margin-left:0.5rem;">Ver Logros â†’</a>
  <a href="{% url 'home' %}" class="action-link" style="margin-left:1rem;">Volver al Dashboard</a>
</div>
{% endblock %}
