{% extends 'base.html' %}
{% block title %}RecomendaciÃ³n Avanzada - {{ tuser.username }} - Gym Icesi{% endblock %}

{% block content %}
<div style="margin-bottom:1.5rem;">
  <a href="{% url 'trainer_feedback' tuser.id %}" class="btn btn-secondary">â† Volver a Detalle de Usuario</a>
</div>

<div class="card" style="max-width:900px;margin:0 auto;">
  <div style="margin-bottom:1.5rem;">
    <h2 style="margin:0 0 0.5rem 0;">ğŸ’¬ RecomendaciÃ³n Avanzada</h2>
    <p style="color:#6b7280;margin:0;">
      EnvÃ­a una recomendaciÃ³n personalizada a <strong>{{ tuser.username }}</strong> con ajustes especÃ­ficos.
    </p>
  </div>

  <form method="post">
    {% csrf_token %}

    <!-- Asociar con Rutina o Progreso -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem;">
      <div>
        <label for="routine_id" style="display:block;margin-bottom:0.5rem;font-weight:500;">
          ğŸ“‹ Asociar con Rutina (opcional)
        </label>
        <select name="routine_id" id="routine_id" class="form-control">
          <option value="">-- Seleccionar rutina --</option>
          {% for rutina in rutinas %}
            <option value="{{ rutina.pk }}">{{ rutina.nombre }}</option>
          {% endfor %}
        </select>
        <small style="color:#6b7280;">Asocia esta recomendaciÃ³n con una rutina especÃ­fica</small>
      </div>

      <div>
        <label for="progress_id" style="display:block;margin-bottom:0.5rem;font-weight:500;">
          ğŸ“Š Asociar con SesiÃ³n de Progreso (opcional)
        </label>
        <select name="progress_id" id="progress_id" class="form-control">
          <option value="">-- Seleccionar sesiÃ³n --</option>
          {% for progress in progresos_recientes %}
            <option value="{{ progress.pk }}">
              {{ progress.routine.nombre }} - {{ progress.fecha|date:"d M Y" }}
            </option>
          {% endfor %}
        </select>
        <small style="color:#6b7280;">Asocia esta recomendaciÃ³n con una sesiÃ³n especÃ­fica</small>
      </div>
    </div>

    <!-- Ajustes de Intensidad y Dificultad -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem;">
      <div>
        <label for="ajuste_intensidad" style="display:block;margin-bottom:0.5rem;font-weight:500;">
          ğŸ’ª Ajuste de Intensidad Sugerido
        </label>
        <select name="ajuste_intensidad" id="ajuste_intensidad" class="form-control">
          <option value="">-- Sin ajuste especÃ­fico --</option>
          <option value="aumentar">Aumentar intensidad</option>
          <option value="mantener">Mantener intensidad actual</option>
          <option value="reducir">Reducir intensidad</option>
        </select>
        <small style="color:#6b7280;">Sugerencia de ajuste en la intensidad del entrenamiento</small>
      </div>

      <div>
        <label for="ajuste_dificultad" style="display:block;margin-bottom:0.5rem;font-weight:500;">
          ğŸ“ˆ Ajuste de Dificultad Sugerido
        </label>
        <select name="ajuste_dificultad" id="ajuste_dificultad" class="form-control">
          <option value="">-- Sin ajuste especÃ­fico --</option>
          <option value="aumentar">Aumentar dificultad</option>
          <option value="mantener">Mantener dificultad actual</option>
          <option value="reducir">Reducir dificultad</option>
        </select>
        <small style="color:#6b7280;">Sugerencia de ajuste en la dificultad de los ejercicios</small>
      </div>
    </div>

    <!-- Mensaje de RecomendaciÃ³n -->
    <div style="margin-bottom:1.5rem;">
      <label for="id_mensaje" style="display:block;margin-bottom:0.5rem;font-weight:500;">
        ğŸ’¬ Mensaje de RecomendaciÃ³n <span style="color:#ef4444;">*</span>
      </label>
      {{ form.mensaje }}
      {% if form.mensaje.errors %}
        <div style="background:#fee2e2;color:#991b1b;padding:0.5rem;border-radius:6px;margin-top:0.25rem;font-size:0.9rem;">
          {{ form.mensaje.errors }}
        </div>
      {% endif %}
      <small style="color:#6b7280;">
        Escribe una recomendaciÃ³n detallada. Puedes incluir:
        <ul style="margin:0.5rem 0 0 1.5rem;padding:0;">
          <li>Comentarios especÃ­ficos sobre ejercicios realizados</li>
          <li>Sugerencias de mejora en la tÃ©cnica</li>
          <li>Recomendaciones de nuevos ejercicios</li>
          <li>MotivaciÃ³n y reconocimiento de logros</li>
        </ul>
      </small>
    </div>

    <!-- Vista Previa de Ajustes -->
    <div id="preview-ajustes" style="display:none;background:#f0f9ff;border:1px solid #bae6fd;border-radius:8px;padding:1rem;margin-bottom:1.5rem;">
      <h4 style="margin:0 0 0.75rem 0;color:#0369a1;">ğŸ“‹ Vista Previa de Ajustes Sugeridos</h4>
      <div id="preview-content" style="color:#111827;"></div>
    </div>

    <div style="display:flex;gap:1rem;">
      <button type="submit" class="btn btn-primary">ğŸ“¤ Enviar RecomendaciÃ³n</button>
      <a href="{% url 'trainer_feedback' tuser.id %}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>

<script>
// Mostrar vista previa de ajustes
document.addEventListener('DOMContentLoaded', function() {
  const intensidadSelect = document.getElementById('ajuste_intensidad');
  const dificultadSelect = document.getElementById('ajuste_dificultad');
  const previewDiv = document.getElementById('preview-ajustes');
  const previewContent = document.getElementById('preview-content');
  
  function updatePreview() {
    const intensidad = intensidadSelect.value;
    const dificultad = dificultadSelect.value;
    
    if (intensidad || dificultad) {
      let content = '<div style="display:flex;flex-direction:column;gap:0.5rem;">';
      
      if (intensidad) {
        const icon = intensidad === 'aumentar' ? 'ğŸ“ˆ' : intensidad === 'reducir' ? 'ğŸ“‰' : 'â¡ï¸';
        const text = intensidad === 'aumentar' ? 'Aumentar' : intensidad === 'reducir' ? 'Reducir' : 'Mantener';
        content += `<div><strong>ğŸ’ª Intensidad:</strong> ${icon} ${text}</div>`;
      }
      
      if (dificultad) {
        const icon = dificultad === 'aumentar' ? 'ğŸ“ˆ' : dificultad === 'reducir' ? 'ğŸ“‰' : 'â¡ï¸';
        const text = dificultad === 'aumentar' ? 'Aumentar' : dificultad === 'reducir' ? 'Reducir' : 'Mantener';
        content += `<div><strong>ğŸ“ˆ Dificultad:</strong> ${icon} ${text}</div>`;
      }
      
      content += '</div>';
      previewContent.innerHTML = content;
      previewDiv.style.display = 'block';
    } else {
      previewDiv.style.display = 'none';
    }
  }
  
  intensidadSelect.addEventListener('change', updatePreview);
  dificultadSelect.addEventListener('change', updatePreview);
});
</script>
{% endblock %}
