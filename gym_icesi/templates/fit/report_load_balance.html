{% extends 'base.html' %}
{% block title %}Informe de Carga - Gym Icesi{% endblock %}

{% block content %}
<div style="margin-bottom:2rem;">
  <h1>ğŸ“ˆ Informe de Carga y Balance</h1>
  <p>AnÃ¡lisis de volumen total de entrenamiento por tipo de ejercicio</p>
</div>

{% if agg %}
  <!-- Resumen de mÃ©tricas -->
  <div class="stats-grid">
    {% for r in agg %}
      <div class="stat-card">
        <span class="stat-icon">
          {% if r.routine__items__exercise__tipo == 'cardio' %}ğŸƒ
          {% elif r.routine__items__exercise__tipo == 'fuerza' %}ğŸ’ª
          {% elif r.routine__items__exercise__tipo == 'movilidad' %}ğŸ§˜
          {% else %}ğŸ‹ï¸
          {% endif %}
        </span>
        <div class="stat-label">{{ r.routine__items__exercise__tipo|title }}</div>
        <div style="display:flex;gap:1.5rem;margin-top:0.75rem;justify-content:center;">
          <div>
            <div style="font-size:1.25rem;font-weight:700;color:var(--brand);">{{ r.total_reps|default:0 }}</div>
            <div style="font-size:0.8rem;color:var(--muted);">Reps</div>
          </div>
          <div>
            <div style="font-size:1.25rem;font-weight:700;color:var(--success);">
              {{ r.total_tiempo|default:0|floatformat:0 }}s
            </div>
            <div style="font-size:0.8rem;color:var(--muted);">Tiempo</div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Tabla detallada -->
  <div class="card">
    <h3>ğŸ“Š Desglose Detallado</h3>
    <table>
      <thead>
        <tr>
          <th>Tipo de Ejercicio</th>
          <th style="text-align:right;">Total Repeticiones</th>
          <th style="text-align:right;">Total Tiempo</th>
          <th style="text-align:right;">Tiempo (min)</th>
        </tr>
      </thead>
      <tbody>
        {% for r in agg %}
          <tr>
            <td>
              <span class="badge badge-{{ r.routine__items__exercise__tipo }}">
                {% if r.routine__items__exercise__tipo == 'cardio' %}ğŸƒ Cardio
                {% elif r.routine__items__exercise__tipo == 'fuerza' %}ğŸ’ª Fuerza
                {% elif r.routine__items__exercise__tipo == 'movilidad' %}ğŸ§˜ Movilidad
                {% else %}{{ r.routine__items__exercise__tipo|title }}
                {% endif %}
              </span>
            </td>
            <td style="text-align:right;font-weight:700;color:var(--brand);">
              {{ r.total_reps|default:0 }} reps
            </td>
            <td style="text-align:right;font-weight:700;color:var(--success);">
              {{ r.total_tiempo|default:0|floatformat:0 }}s
            </td>
            <td style="text-align:right;color:var(--muted);">
              {% widthratio r.total_tiempo 60 1 %} min
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- AnÃ¡lisis y recomendaciones -->
  <div class="row" style="margin-top:1.5rem;">
    <div class="col">
      <div class="card" style="background:#eff6ff;border-color:#dbeafe;">
        <h3 style="color:#1e40af;">ğŸ’¡ Balance Ideal</h3>
        <p style="color:#1e3a8a;margin-bottom:0.5rem;">
          Un programa equilibrado debe incluir:
        </p>
        <ul style="color:#1e3a8a;margin:0;">
          <li>ğŸƒ Cardio: 150-300 min/semana</li>
          <li>ğŸ’ª Fuerza: 2-3 dÃ­as/semana</li>
          <li>ğŸ§˜ Movilidad: Diariamente</li>
        </ul>
      </div>
    </div>

    <div class="col">
      <div class="card" style="background:#fef3c7;border-color:#fde68a;">
        <h3 style="color:#92400e;">âš ï¸ RecomendaciÃ³n</h3>
        <p style="color:#78350f;margin-bottom:0;">
          Revisa tu distribuciÃ³n de ejercicios. Un balance adecuado entre cardio,
          fuerza y movilidad es clave para resultados Ã³ptimos y prevenciÃ³n de lesiones.
        </p>
      </div>
    </div>
  </div>

  <!-- GrÃ¡fico visual simple con barras -->
  <div class="card" style="margin-top:1.5rem;">
    <h3>ğŸ“Š DistribuciÃ³n Visual de Carga</h3>
    <div style="display:flex;flex-direction:column;gap:1rem;margin-top:1rem;">
      {% for r in agg %}
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:0.5rem;">
            <span style="font-weight:600;color:#10314a;">
              {{ r.routine__items__exercise__tipo|title }}
            </span>
            <span style="color:var(--muted);">
              {{ r.total_reps|default:0 }} reps | {{ r.total_tiempo|default:0|floatformat:0 }}s
            </span>
          </div>
          <div class="progress-bar" style="height:24px;">
            <div class="progress-fill" style="width:{% if r.total_reps > 0 %}{% widthratio r.total_reps 500 100 %}{% else %}10{% endif %}%;display:flex;align-items:center;padding:0 0.5rem;color:white;font-size:0.85rem;font-weight:700;">
              {% if r.total_reps > 50 %}{{ r.total_reps }} reps{% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

{% else %}
  <!-- Estado vacÃ­o -->
  <div class="card">
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ“Š</div>
      <h3>No hay datos disponibles</h3>
      <p>No tienes registros de progreso aÃºn. Comienza a registrar tus entrenamientos para ver tu balance de carga.</p>
      <a href="{% url 'progress_create' %}" class="btn btn-success">Registrar Progreso</a>
    </div>
  </div>
{% endif %}

<!-- NavegaciÃ³n -->
<div style="margin-top:2rem;text-align:center;">
  <a href="{% url 'report_adherence' %}" class="btn">Ver Informe de Adherencia â†’</a>
  <a href="{% url 'home' %}" class="action-link" style="margin-left:1rem;">Volver al Dashboard</a>
</div>
{% endblock %}
